{% load static %} <!-- Cargamos los archivos estaticos -->
{% load static %}
{% load i18n %}

<!DOCTYPE HTML>
<html lang="es-ES">

<head>
    <meta http-equiv="Content-type" content="text/html" charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/png" href='{% static "common/img/logo.ico"%}' sizes="32x32">
    <title>RoboticsAcademy</title>
    <link rel="stylesheet" href="{% static 'common/css/main.css' %}">
    <link rel="stylesheet" href="{% static 'common/css/split_style.css' %}">
    <link rel="stylesheet" href="{% static 'common/css/gui.css' %}">
    <link rel="stylesheet" href="{% static 'common/css/console.css' %}">
    <!-- Bootstrap 3.3.7 from local -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.1.0/css/flag-icon.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css">

    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"
        type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <!-- SWAL -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>


    <!-- Roboto Typography -->
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>

    <!-- Hoja de Estilo principal de la AplicaciÃ³n (Main Styles) -->
    <link rel="stylesheet" type="text/css" href="{% static 'common/css/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'common/css/navbar.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'common/css/animate.css' %}">

    <!--Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <style>
        /* Styling h1 tag */
        h1 {
            color: green;
            text-align: center;
        }

        /* Styling modal */
        .modal .modal-content {
            padding: 20px 20px 20px 20px;
            width: 650px;
            -webkit-animation-name: modal-animation;
            -webkit-animation-duration: 0.5s;
            animation-name: modal-animation;
            animation-duration: 0.5s;
        }

        .content {
            visibility: visible;
        }

        @-webkit-keyframes modal-animation {
            from {
                top: -100px;
                opacity: 0;
            }

            to {
                top: 0px;
                opacity: 1;
            }
        }

        @keyframes modal-animation {
            from {
                top: -100px;
                opacity: 0;
            }

            to {
                top: 0px;
                opacity: 1;
            }
        }

        #container {
            width: 100%;
            height: 100%;
            position: absolute;
            visibility: hidden;
            display: none;
            background-color: rgba(22, 22, 22, 0.5);
        }

        #container:target {
            visibility: visible;
            display: block;
        }

        .carousel-control-prev-icon, .carousel-control-next-icon {filter: invert(100%); }

        .carousel-control-prev-icon{
            position: absolute;
            left: 0%;
        }
        .carousel-control-next-icon{
            position: absolute;
            right: 0%;
        }

        .carousel-item-controls p { padding-left: 6px;}
        .carousel-item-controls img {width: 20px; height: 20px}

        #chat-content{
            display: flex;
            flex-direction: row;
        }
        #chat-log{
            width: auto;
            height: 50vh;
            border: 1px solid black;
            overflow-y: scroll;
        }
        #chat-div p#chat-title{
            text-align: center;
        }
        #stream-div{
            border: 1px solid black;
        }

        #chat-div {
            width: 450px;
            margin: auto;
            float: right;
        }
        input[type=text]#chat-message-input{
            width: 100%;
            padding: 12px 20px;
            margin: 8px 0;
            display: inline-block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        #chat-log{
            padding: 12px 20px;
            margin: 8px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        #chat-message-submit{
            width: 100%;
        }

        .send{
            text-align: right;
        }

        .receive{
            text-align: left;
        }

        video{
            display: block;
        }

    </style>
</head>


<body>

    <!-- NAVBAR -->
    {% include 'navbar.html' %}

    <script>
        var launch_level = 0;
        // Changes connection step value
        function set_launch_level(level) {
            launch_level = level;
        }
        function get_launch_level() {
            return launch_level;
        }

    </script>


   {% include 'toolbar.html'%}

<script>

// Simulate variable
let simulate_mode = false;
		// Simulate button
		const simulate_btn = document.querySelector('#gazebo_button');
		const simulate_img = document.querySelector('#gzimg');
		simulate_btn.addEventListener('click', function(){

			if(!simulate_mode){

				// Activate mode
				simulate_mode = true;
				simulate_btn.style.background = '#BEBEBE';
				simulate_img.src = "{% static 'common/img/gazebo_on.svg' %}";
				return;
			}

			// Else, turn of teleop mode and remove event listeners
			simulate_mode = false;
			simulate_btn.style.background = 'transparent';
			simulate_img.src = "{% static 'common/img/gazebo.svg' %}";

			return;


		});

		function deactivateSimulateButton() {
			simulate_mode = false;
			simulate_btn.style.background = 'transparent';
			simulate_img.src = "{% static 'common/img/gazebo.svg' %}";

		}

		// Console variable
		let console_mode = false;
		// Console button
		const console_btn = document.querySelector('#console_button');
		const console_img = document.querySelector('#terminalimg');
		console_btn.addEventListener('click', function(){

			if(!console_mode){

				// Activate mode
				console_mode = true;
				console_btn.style.background = '#BEBEBE';
				console_img.src = "{% static 'common/img/console_on.svg' %}";
				return;
			}

			// Else, turn of teleop mode and remove event listeners
			console_mode = false;
			console_btn.style.background = 'transparent';
			console_img.src = "{% static 'common/img/console.svg' %}";

			return;


		});
		function deactivateConsoleButton() {
			console_mode = false;
			console_btn.style.background = 'transparent';
			console_img.src = "{% static 'common/img/console.svg' %}";

		}

        // Teleop variable
        let teleop_mode = false;
		// Teleop button
		const teleop_btn = document.querySelector('#teleop_button');
		const teleop_img = document.querySelector('#teleop_img');

		teleop_btn.addEventListener('click', function(){
			// If variable is false, activate teleoperate mode
			if(!teleop_mode){
				if (running == false) {
					resumeSimulation();
					running == true;
				}
				// Activate mode
				teleop_mode = true;
				teleop_btn.style.background = '#BEBEBE';
				teleop_img.src = "{% static 'common/img/joystick_on.svg' %}";
				document.addEventListener('keydown', keyHandler, false);
				document.addEventListener('keyup', keyHandler, false);
				return;
			}

			// Else, turn of teleop mode and remove event listeners
			teleop_mode = false;
			submitCode();
			teleop_btn.style.background = 'transparent';
			teleop_img.src = "{% static 'common/img/joystick_off.svg' %}";
			document.removeEventListener('keydown', keyHandler, false);
			document.removeEventListener('keyup', keyHandler, false);
			return;
		});

		function deactivateTeleopButton() {
			teleop_mode = false;
			teleop_btn.style.background = 'transparent';
			teleop_img.src = "{% static 'common/img/joystick_off.svg' %}";
			document.removeEventListener('keydown', keyHandler, false);
			document.removeEventListener('keyup', keyHandler, false);
		}


    		// Car variables
		let v = 0;
		let w = 0;

		// Event Handlers for controls
		function keyHandler(event) {
			// Right (39), Left (37), Down (40), Up (38)

			// First check if websocket_gui_guest and websocket_code_guest are defined
			if((typeof(websocket_gui) !== 'undefined' && (typeof(websocket_code) !== 'undefined'))){
				let cmd = "#tele";

				// Prevent using arrow keys to scroll page
				if([32, 37, 38, 39, 40].indexOf(event.keyCode) > -1) {
					event.preventDefault();
				}

				if(event.keyCode == 39) {
					//console.log('Right');
					w = (event.type == 'keydown')?-1:0;
				}else if(event.keyCode == 37) {
					//console.log('Left');
					w = (event.type == 'keydown')?1:0;
				}else if(event.keyCode == 40) {
					//console.log('Down');
					v = (event.type == 'keydown')?-2:0;
				}else if(event.keyCode == 38) {
					//console.log('Up');
					v = (event.type == 'keydown')?2:0;
				}
				console.log('v: ', v, 'w: ', w);
			}
		}

</script>



    <div id="theory-view" style="display: none;">
          <!-- borrar esto -->
        {% if exercise_id == "obstacle_avoidance_2" %}
            <iframe src="https://jderobot.github.io/RoboticsAcademy/exercises/AutonomousCars/obstacle_avoidance" id="iframe-tab"></iframe>
            {% else %}
            <iframe src="https://jderobot.github.io/RoboticsAcademy/exercises/AutonomousCars/{{ exercise_id }}" id="iframe-tab"></iframe>
        {% endif %}

    </div>

    <div class="content" id="exercise-view">
        <div class="split a">
            <br>
            {% if "code_control" in indexs %}
                {% include 'code_control.html' %}
            {% endif %}
        </div>
        <div class="split b">
            {% if "visualization" in indexs %}
                {% include 'visualization.html' %}
            {% endif %}
            <br>
            {% if "gazebo" in indexs %}
                {% include 'gazebo.html' %}
            {% endif %}
            <hr>
            <div class="row">
                <div class="col-md-12">
                    <iframe id="console-vnc" style="display:none;" src="" width="100%" height="100%"></iframe>
                </div>
            </div>
            {% if "console" in indexs %}
                {% include 'console.html' with exercise="obstacle_avoidance" %}
            {% endif %}

    <!-- Common -->
    <script src="{% static 'common/ace-builds/src-noconflict/ace.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'common/js/utils.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'common/js/setIframe.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'common/js/local_functions.js' %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static 'common/js/websocket_address.js' %}" type="text/javascript" charset="utf-8"></script>
    <!-- Exercise specific resources -->
    {% for file in statics %}
        <!-- borrar esto -->
        {% if exercise_id == "obstacle_avoidance_2" %}
            <script src="{% static 'exercises/'%}obstacle_avoidance/js/{{ file }}" type="text/javascript" charset="utf-8"></script>
            {% else %}
            <script src="{% static 'exercises/'%}{{ exercise_id }}/js/{{ file }}" type="text/javascript" charset="utf-8"></script>
        {% endif %}

    {% endfor %}

    <!-- BOTON DE CONEXION CON RADI-->
    {% if "connect_button" in indexs %}
        {% include 'connect_button.html' %}
    {% endif %}

    {% if user_code|length > 0%}

    <script type="text/javascript">
        code = "{{user_code}}".replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&gt;/g, ">").replace(/&lt;/g, "<").replace(/&amp;gt;/g, ">").replace(/&amp;lt;/g, "<").replace(/&amp;ge;/g, ">=").replace(/&amp;le;/g, "<=").replace(/&le;/g, "<=").replace(/&ge;/g, ">=");

        console.log(code);
        editorele.setValue(code)
    </script>
    {% endif %}

    </div>

    </div>


    {% if not simulation_site %}
    <div class="footer">
        <span><b>Release {{version}}</b></span> | <span>Derechos de autor &copy;
            <script>document.write(new Date().getFullYear())</script> - AsociaciÃ³n JdeRobot.
        </span> Este sitio utiliza cookies. <a href="/terms#cookies" target="_blank">MÃ¡s InformaciÃ³n</a>
    </div>
    {% endif %}
{% include "info_modal.html" %}
{% include "load_modal.html" %}
</body>
</html>


